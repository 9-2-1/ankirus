<html>
  <head>
    <meta charset="UTF-8" />
    <title>Treemap</title>
    <style>
      .container {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        height: 100vh;
        gap: 20px;
        padding: 20px;
      }
      .content-col {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        gap: 20px;
      }
      .description {
        border: 1px solid #ccc;
        padding: 15px;
        overflow: auto;
      }
      .treemap {
        justify-content: center;
        align-items: center;
      }
      .description .retrievability {
        font-size: 40px;
        font-weight: bold;
        text-align: right;
      }
      .description .group {
        font-size: 20px;
        font-weight: bold;
      }
      .description .question {
        position: relative;
        font-size: 20px;
        max-width: 50vw;
        max-height: 40vh;
        overflow: auto;
      }
      .description img {
        max-width: 48vw;
        max-height: 50vh;
      }
      .description .answer {
        position: relative;
        font-size: 20px;
        max-width: 50vw;
        max-height: 40vh;
        overflow: auto;
        display: none;
      }
      .description .answer.shown {
        display: block;
      }
      .description * {
        margin: 10px;
      }
    </style>
    <script src="purify.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        window.onload = function () {
          const svgElement = document.querySelector(".treemap svg");
          const rects = svgElement.querySelectorAll("rect[data-text]");
          const description = document.querySelector(".description");
          let lockedElement = null;

          // 更新显示内容的函数
          function updateDescription(element) {
            const text = element.getAttribute("data-text");
            description.innerHTML = DOMPurify.sanitize(text);
            updateShowAnswer();
          }
          function updateShowAnswer() {
            const answerElements = document.querySelectorAll(
              ".description .answer",
            );
            if (showAnswerCheckbox.checked) {
              answerElements.forEach((el) => el.classList.add("shown"));
            } else {
              answerElements.forEach((el) => el.classList.remove("shown"));
            }
          }
          const showAnswerCheckbox = document.getElementById("show-answer");
          showAnswerCheckbox.addEventListener("change", function () {
            updateShowAnswer();
          });

          // 标记根节点
          root = rects[0];
          updateDescription(root);
          // 为每个矩形添加事件监听
          rects.forEach((rect) => {
            // 鼠标悬停事件 - 仅在未锁定时更新
            rect.addEventListener("mouseover", function () {
              if (!lockedElement) {
                updateDescription(rect);
              }
            });

            rect.addEventListener("mouseout", function () {
              if (!lockedElement) {
                updateDescription(root);
              }
            });

            // 点击事件 - 锁定/解锁当前元素
            rect.addEventListener("click", function () {
              if (lockedElement === rect) {
                // 解锁
                lockedElement = null;
                rect.style.strokeWidth = "0.5px";
              } else {
                // 锁定到当前元素
                if (lockedElement) {
                  lockedElement.style.strokeWidth = "0.5px";
                }
                lockedElement = rect;
                rect.style.strokeWidth = "5px";
                updateDescription(rect);
              }
            });
          });
        };
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div class="content-col">
        <div class="checkbox-container">
          <input type="checkbox" id="show-answer" />
          <label for="show-answer">显示答案</label>
        </div>
        <div class="description"></div>
      </div>
      <div class="treemap">
        <!-- TREEMAP_HERE -->
      </div>
    </div>
  </body>
</html>

<!-- vim: set expandtab tabstop=2: -->
